<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Web Tra C·ª©u - Nguy·ªÖn VƒÉn ƒê·∫°o</title>
<!-- CSS Select2 -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>
<!-- Th√™m i18next v√† i18next-browser-languagedetector -->
<script src="https://unpkg.com/i18next@21.6.3/dist/umd/i18next.min.js"></script>
<script src="https://unpkg.com/i18next-browser-languagedetector@6.1.2/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>
<style>
    /* C√†i ƒë·∫∑t CSS c∆° b·∫£n */
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font-family: Arial, sans-serif;
      background: url('background.jpg') no-repeat center center/cover;
      color: #333;
      display: flex;
      flex-direction: column;
    }
    .page-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .top-container {
      flex: 0 0 auto;
      background: rgba(0, 0, 0, 0.85);
      padding: 15px;
      max-height: 40vh;
      overflow-y: auto;
      position: relative;
    }
    .header {
      text-align: center;
      padding: 10px;
      position: relative;
    }
    .tasks-link {
  position: absolute;
  top: 10px;
  left: 10px;
  color: #fff;
  background: #007bff;
  padding: 5px 10px;
  border-radius: 4px;
  text-decoration: none;
  font-weight: bold;
  transition: background 0.3s;
}
.tasks-link:hover {
  background: #0056b3;
}
    .header h1 { margin: 0; font-size: 28px; color: white; }
    .header p { margin: 5px 0 0; font-size: 16px; color: #ddd; }
    /* Language switcher ·ªü g√≥c tr√™n b√™n ph·∫£i */
    .language-switcher {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    .language-switcher button {
      padding: 4px 8px;
      margin-left: 5px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      border-radius: 3px;
      background: #ff8c00;
      color: white;
      transition: background 0.3s;
    }
    .language-switcher button:hover {
      background: #ff6500;
    }
    /* Kh·ªëi ch·ª©a c√°c ti√™u ch√≠ l·ªçc */
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 5px;
    }
    .filter-block {
      background: #444;
      border-radius: 5px;
      padding: 5px;
      margin: 5px;
      width: 180px;
      font-size: 12px;
      color: white;
    }
    .filter-block label {
      display: block;
      margin-bottom: 3px;
      font-weight: bold;
    }
    .filter-block select {
      width: 100%;
      padding: 3px;
      margin-bottom: 3px;
      font-size: 12px;
    }
    /* Kh·ªëi ch·ª©a c√°c n√∫t ch·ª©c nƒÉng */
    .action-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 5px;
    }
    .action-bar > div {
      background: #444;
      border-radius: 5px;
      padding: 5px;
      margin: 5px;
      font-size: 12px;
      color: white;
      text-align: center;
    }
    .action-bar button {
      padding: 6px 12px;
      font-size: 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: 0.3s;
      margin: 3px;
    }
    .filter-actions button {
      background: linear-gradient(45deg, #ff8c00, #ff4500);
      color: white;
    }
    .filter-actions button:hover {
      background: linear-gradient(45deg, #ff6500, #ff0000);
    }
    .download-container button {
      background: linear-gradient(45deg, #007bff, #0056b3);
      color: white;
    }
    .download-container button:hover {
      background: linear-gradient(45deg, #3399ff, #007bff);
    }
    .zoom-controls button {
      background: linear-gradient(45deg, #28a745, #218838);
      color: white;
    }
    .zoom-controls button:hover {
      background: linear-gradient(45deg, #34d058, #28a745);
    }
    /* Ph·∫ßn hi·ªÉn th·ªã t·ªïng s·ªë d√≤ng */
    .results-count {
      text-align: center;
      margin: 5px;
      font-size: 14px;
      color: white;
    }
    /* B·∫£ng d·ªØ li·ªáu */
    .table-container {
      flex: 1 1 auto;
      margin: 5px auto;
      width: 98%;
      max-height: calc(100vh - 260px);
      overflow-y: auto;
      overflow-x: auto;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    table {
      width: auto;
      border-collapse: collapse;
      table-layout: fixed;
    }
    th, td {
      padding: 6px 8px;
      border: 1px solid #ccc;
      font-size: 12px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background: #4a76a8;
      color: white;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    .sticky-col-1 {
      position: sticky;
      left: 0;
      width: 40px;
      min-width: 40px;
      background: #4a76a8;
      z-index: 3;
    }
    .sticky-col-2 {
      position: sticky;
      left: 40px;
      width: 100px;
      min-width: 100px;
      background: #4a76a8;
      z-index: 3;
    }
    .sticky-col-3 {
      position: sticky;
      left: 140px;
      width: 50px;
      min-width: 50px;
      background: #4a76a8;
      z-index: 3;
    }
    td.sticky-col-1, td.sticky-col-2, td.sticky-col-3 {
      background: #e6e6e6;
      color: #333;
      z-index: 1;
    }
    tr.selected { background-color: #ffeb99 !important; }
    .footer {
      flex: 0 0 auto;
      text-align: center;
      padding: 5px;
      font-size: 14px;
      background: #333;
      color: white;
    }
    @media (max-width: 768px) {
  /* ƒê∆∞a language switcher xu·ªëng d∆∞·ªõi ti√™u ƒë·ªÅ */
  .language-switcher {
    position: static;
    margin-top: 10px;
    text-align: center;
  }
  .language-switcher button {
    padding: 3px 6px;
    margin: 0 3px;
    font-size: 10px;
  }

  /* Gi·∫£m kho·∫£ng c√°ch v√† k√≠ch th∆∞·ªõc n√∫t ch·ª©c nƒÉng */
  .action-bar {
    justify-content: center;
    padding: 3px;
  }
  .action-bar > div {
    margin: 3px auto;
    padding: 3px;
    font-size: 14px;
  }
  .action-bar button {
    padding: 4px 8px;
    margin: 2px;
    font-size: 14px;
  }
}

    @media (max-width: 768px) {
      .filter-bar, .action-bar {
        flex-direction: column;
        align-items: stretch;
      }
      .filter-block, .action-bar > div {
        width: 90%;
        margin: 5px auto;
      }
      .header h1 { font-size: 24px; }
      .header p { font-size: 14px; }
      table, th, td { font-size: 10px; }
      .table-container {
        max-height: calc(100vh - 320px);
      }
    }
    @media (max-width: 480px) {
      .tasks-link {
    position: relative;
    top: 0;
    left: 0;
    display: block;
    width: 100%;
    text-align: center;
    padding: 10px 0;
    font-size: 16px;
  }
      .header h1 { font-size: 20px; }
      .header p { font-size: 12px; }
      table, th, td { font-size: 9px; }
    }
  
@media (max-width: 768px) {
  body {
    padding-bottom: 300px; /* ch·ª´a ch·ªó cho b√†n ph√≠m */
  }
}

@media screen and (orientation: landscape), (orientation: portrait) {
  .table-container {
    max-height: 60vh;
    overflow-y: auto;
    overflow-x: auto;
    touch-action: pan-y;
  }

  table {
    width: auto;
    min-width: 100%;
  }

  td, th {
    word-break: break-word;
  }
}

/* T·ªëi ∆∞u b·∫£ng cho ƒëi·ªán tho·∫°i xoay ngang/d·ªçc v√† khi m·ªü b√†n ph√≠m */
.table-container {
  width: 100vw;
  max-height: 50vh;
  overflow-x: auto;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  touch-action: auto;
}

@media screen and (orientation: landscape) {
  .table-container {
    max-height: 60vh;
  }
}

@media screen and (orientation: portrait) {
  .table-container {
    max-height: 50vh;
  }
}

table {
  min-width: 800px;
}

th, td {
  word-break: break-word;
  white-space: nowrap;
}

.table-container {
  width: 100%;
  overflow-x: auto;
  overflow-y: auto;
  max-height: 60vh;
  -webkit-overflow-scrolling: touch;
}
table {
  border-collapse: collapse;
  min-width: 1000px;
}
th, td {
  white-space: nowrap;
  padding: 6px;
  font-size: 12px;
}
.sticky-col-1 {
  position: sticky; left: 0; background: #4a76a8; z-index: 3;
}
.sticky-col-2 {
  position: sticky; left: 40px; background: #4a76a8; z-index: 3;
}
.sticky-col-3 {
  position: sticky; left: 140px; background: #4a76a8; z-index: 3;
}
td.sticky-col-1, td.sticky-col-2, td.sticky-col-3 {
  background: #f3f3f3;
}

/* --- C·∫£i ti·∫øn cho input khi focus --- */
input:focus, select:focus {
  outline: 2px solid #ff8c00;
  background-color: #fffce6;
}

/* TƒÉng font input tr√™n ƒëi·ªán tho·∫°i ƒë·ªÉ d·ªÖ nh·∫≠p */
@media (max-width: 768px) {
  input, select {
    font-size: 16px;
  }
}

/* C·∫£i thi·ªán b·∫£ng khi xoay ngang */
@media screen and (orientation: landscape) {
  .top-container {
    max-height: 30vh;
    overflow-y: auto;
  }
  .table-container {
    height: auto;
    max-height: 90vh;
    min-height: 70vh;
    overflow-x: auto;
    overflow-y: auto;
  }
  table {
    min-width: 1200px;
  }
}

</style>
</head>
<body>
<div class="page-container">
<div class="top-container">
<div class="header">
<a class="tasks-link" href="/tasks">Tasks</a>
<h1 id="header-title">FAIR TEAM - Tra c·ª©u t√¨nh tr·∫°ng FAIR</h1>
<p id="header-subtitle">Tra c·ª©u t√¨nh tr·∫°ng FAIR</p>
<!-- N√∫t chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ ·ªü g√≥c tr√™n b√™n ph·∫£i -->
<div class="language-switcher">
<button onclick="changeLanguage('vi')">Vi</button>
<button onclick="changeLanguage('en')">En</button>
<button onclick="changeLanguage('ko')">Ko</button>
</div>
</div>
<!-- Ph·∫ßn ti√™u ch√≠ l·ªçc -->


<div class="filter-bar">
  <!-- Filter Block 0: Customer -->
  <div class="filter-block" id="filter-block-0">
    <label for="filter-value-0" id="label-filter-customer">Ch·ªçn Customer</label>
    <select class="value-select" id="filter-value-0" multiple="multiple"></select>
  </div>
  <!-- Filter Block 1 -->
  <div class="filter-block" id="filter-block-1">
    <label for="filter-column-1" id="label-criteria-1">Ch·ªçn ti√™u ch√≠ s·ªë 1:</label>
    <select id="filter-column-1"></select>
    <label for="filter-value-1" id="label-filter-value-1">Ch·ªçn gi√° tr·ªã</label>
    <select class="value-select" id="filter-value-1" multiple="multiple"></select>
  </div>
  <!-- Filter Block 2 -->
  <div class="filter-block" id="filter-block-2">
    <label for="filter-column-2" id="label-criteria-2">Ch·ªçn ti√™u ch√≠ s·ªë 2:</label>
    <select id="filter-column-2"></select>
    <label for="filter-value-2" id="label-filter-value-2">Ch·ªçn gi√° tr·ªã</label>
    <select class="value-select" id="filter-value-2" multiple="multiple"></select>
  </div>
  <!-- Filter Block 3 -->
  <div class="filter-block" id="filter-block-3">
    <label for="filter-column-3" id="label-criteria-3">Ch·ªçn ti√™u ch√≠ s·ªë 3:</label>
    <select id="filter-column-3"></select>
    <label for="filter-value-3" id="label-filter-value-3">Ch·ªçn gi√° tr·ªã</label>
    <select class="value-select" id="filter-value-3" multiple="multiple"></select>
  </div>
</div>

<!-- Kh·ªëi ch·ª©a c√°c n√∫t ch·ª©c nƒÉng -->
<div class="action-bar">
<div class="filter-actions">
<button id="apply-filters">√Åp D·ª•ng L·ªçc</button>
<button id="clear-filters">X√≥a L·ªçc</button>
</div>
<div class="download-container">
<button id="download-excel">Xu·∫•t Excel (ƒêang xem)</button>
<button id="export-all">Xu·∫•t Excel (T·∫•t c·∫£)</button>
</div>
<div class="zoom-controls">
<button id="zoom-in">Ph√≥ng to</button>
<button id="zoom-out">Thu nh·ªè</button>
</div>
</div>
<!-- Ph·∫ßn hi·ªÉn th·ªã t·ªïng s·ªë d√≤ng -->
<div class="scan-camera" style="text-align:center; margin-top:10px;">
<button id="btnScanCamera">üì∑ Qu√©t Camera</button>
</div>
<div class="results-count" id="results-count">Total rows: 0</div>
</div>
<!-- Khu v·ª±c hi·ªÉn th·ªã b·∫£ng d·ªØ li·ªáu -->
<div class="table-container">
<table id="results-table">

<thead><tr>
<th class="sticky-col-1">No</th>
<th class="sticky-col-2">Part Number</th>
<th class="sticky-col-3">REV</th>
<th>Approval Status</th>
<th>Customer</th>
<th>Commodity</th>
<th>Part Pictures</th>
<th>Packaging Pictures</th>
<th>Critical</th>
<th>CE</th>
<th>PO Number</th>
<th>Description</th>
<th>Type</th>
<th>Note Number</th>
<th>PO received date</th>
<th>Customer need date</th>
<th>Requirements</th>
<th>FAIR Cover sheet</th>
<th>Bubble Drawings</th>
<th>Datasheet form</th>
<th>LAIR Data</th>
<th>FAIR Data</th>
<th>COC</th>
<th>BOM</th>
<th>Mill</th>
<th>Test reports / evidences</th>
<th>Production Status</th>
<th>Remark 1</th>
<th>Remark 2</th>
<th>Submit date</th>
<th>Reject comments</th>
</tr></thead>
<tbody>
<!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c load t·∫°i ƒë√¢y -->
</tbody>
</table>
</div>
<!-- N√∫t t·∫£i th√™m -->
<div id="load-more-container" style="text-align:center; margin:10px;">
<button id="load-more">Load More</button>
<button id="load-all">Load All</button>
</div>
<!-- Footer -->
<div class="footer" id="footer-text">Ng∆∞·ªùi ph√°t tri·ªÉn: Nguy·ªÖn VƒÉn ƒê·∫°o</div>
</div>
<!-- JS Th∆∞ vi·ªán -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/colresizable/1.6/colResizable-1.6.min.js"></script>
<!-- i18next Integration -->

<script>
// Populate criteria selects for blocks 1-3
function populateCriteriaSelects() {
  if (!allData || allData.length === 0) {
    setTimeout(populateCriteriaSelects, 100);
    return;
  }
  const headerOrder = Object.keys(allData[0]);
  const criteriaOptions = headerOrder.filter(col => col !== 'Customer');
  [1,2,3].forEach(i => {
    const sel = $(`#filter-column-${i}`);
    sel.empty();
    criteriaOptions.forEach(col => sel.append(new Option(col, col)));
  });
}

// Update distinct values for a block
function updateFilterValuesForBlock(blockIndex) {
  if (!allData) {
    setTimeout(() => updateFilterValuesForBlock(blockIndex), 100);
    return;
  }
  let filtered = allData.slice();
  // Apply previous filters
  for (let i = 0; i < blockIndex; i++) {
    const col = (i===0) ? 'Customer' : $(`#filter-column-${i}`).val();
    const vals = $(`#filter-value-${i}`).val();
    if (col && vals && vals.length) {
      filtered = filtered.filter(row =>
        vals.some(v => row[col] && row[col].toString().toLowerCase().includes(v.toLowerCase()))
      );
    }
  }
  // Determine column for current block
  const depCol = (blockIndex===0) ? 'Customer' : $(`#filter-column-${blockIndex}`).val();
  const vals = filtered.map(r => r[depCol]|| '').filter(v=>v!=='');
  const distinct = Array.from(new Set(vals.map(v=>v.toString().toUpperCase()))).sort();
  const sel = $(`#filter-value-${blockIndex}`);
  sel.empty();
  distinct.forEach(v=>sel.append(new Option(v, v)));
  sel.trigger('change');
}

// Cascade update
function updateCascade(startBlock) {
  for (let i = startBlock; i <= 3; i++) {
    updateFilterValuesForBlock(i);
  }
}

// Apply filters
function applyFilters(reset=true) {
  if (reset) { currentOffset=0; $('#results-table tbody').empty(); }
  let params={ limit:pageSize, offset:currentOffset };
  for (let i=0;i<=3;i++){
    const col=(i===0)?'Customer':$(`#filter-column-${i}`).val();
    const vals=$(`#filter-value-${i}`).val();
    if (vals && vals.length) params[col]=vals.join(',');
  }
  currentFilters=params;
  $.getJSON(`/search?${$.param(params)}`, resp=>{
    totalData=resp.total; currentOffset+=pageSize; updateTable(resp.data,true);
  });
}

// Document ready
$(document).ready(function(){
  loadAllData();
  $('.value-select').select2({ placeholder: i18next.t('choose_value'), allowClear:true, width:'100%', closeOnSelect:false });
  $('#filter-value-0').on('change', ()=> updateCascade(1));
  [1,2,3].forEach(i=>{
    $(`#filter-column-${i}`).on('change', ()=>{ updateFilterValuesForBlock(i); updateCascade(i+1); });
    $(`#filter-value-${i}`).on('change', ()=> updateCascade(i+1));
  });
});

// Override loadAllData
function loadAllData() {
  $.getJSON('/search?limit=1000000', resp => {
    allData = resp.data; totalData = resp.total;
    populateCriteriaSelects();
    updateCascade(0);
  });
}
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('ocrInput');
  if (input) {
    input.addEventListener('focus', () => {
      setTimeout(() => {
        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    });
  }
});
</script><script>
document.addEventListener('DOMContentLoaded', function () {
  const inputs = document.querySelectorAll('.filter-bar input, .filter-bar select');
  inputs.forEach((input) => {
    input.addEventListener('focus', () => {
      setTimeout(() => {
        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const inputs = document.querySelectorAll('input, select, textarea');
  inputs.forEach((el) => {
    el.addEventListener('focus', () => {
      setTimeout(() => {
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    });
  });
});


<!-- HTML: s·ª≠a ID cho ƒë√∫ng v√† ƒë·ªìng b·ªô -->
<div class="filter-block" id="filter-block-project">
  <label for="filter-project" id="label-filter-project">Ch·ªçn d·ª± √°n (Customer)</label>
  <select class="value-select" id="filter-project" multiple="multiple"></select>
</div>

<!-- JS: loadDistinctValuesForBlock d·ª±a theo logic blockIndex -->

<script>
function updateFilterValuesForBlock(blockIndex) {
  if (!allData) {
    setTimeout(function(){ updateFilterValuesForBlock(blockIndex); }, 100);
    return;
  }
  let filteredData = allData.slice();
  // Apply previous filters
  for (let i = 1; i < blockIndex; i++) {
    let col = (i === 1) ? 'Customer' : $(`#filter-column-${i}`).val();
    let values = $(`#filter-value-${i}`).val();
    if (col && values && values.length > 0) {
      filteredData = filteredData.filter(row =>
        values.some(v => row[col] && row[col].toString().toLowerCase().includes(v.toLowerCase()))
      );
    }
  }
  // Determine column for current block
  let dependentColumn = (blockIndex === 1) ? 'Customer' : $(`#filter-column-${blockIndex}`).val();
  // Extract distinct values
  let values = filteredData.map(row => row[dependentColumn] || '').filter(v => v !== '');
  let distinctValues = Array.from(new Set(values.map(v => v.toString().toUpperCase())));
  distinctValues.sort((a, b) => a.localeCompare(b));
  // Populate select
  const selectElem = $(`#filter-value-${blockIndex}`);
  selectElem.empty();
  distinctValues.forEach(val => {
    selectElem.append(new Option(val, val, false, false));
  });
  selectElem.trigger('change');
}
</script>


<!-- JS: g·ªçi updateFilterValuesForBlock(0) khi load -->
<script>
$(document).ready(function() {
  loadAllData();

  $('.value-select').not('#filter-value-2').select2({
    placeholder: i18next.t("choose_value"),
    allowClear: true,
    width: '100%',
    closeOnSelect: false
  });
  $('#filter-value-2').select2({
    placeholder: i18next.t("choose_value"),
    allowClear: true,
    width: '100%'
  });
  $('#filter-project').select2({
    placeholder: i18next.t("choose_project"),
    allowClear: true,
    width: '100%',
    closeOnSelect: false
  });

  $('#filter-project').on('change', function() {
    updateCascade(1);
  });

  $('#filter-column-1').on('change', function() {
    updateFilterValuesForBlock(1);
    updateCascade(2);
  });
  $('#filter-value-1').on('change', function() {
    updateCascade(2);
  });
  $('#filter-column-2').on('change', function() {
    updateFilterValuesForBlock(2);
    updateCascade(3);
  });
  $('#filter-value-2').on('change', function() {
    updateCascade(3);
  });
  $('#filter-column-3').on('change', function() {
    updateFilterValuesForBlock(3);
  });

  updateFilterValuesForBlock(0);
});
</script>

<!-- JS: cascade to√†n b·ªô -->

<script>
function updateCascade(startBlock) {
  for (let i = startBlock; i <= 4; i++) {
    updateFilterValuesForBlock(i);
  }
}
</script>


<!-- JS: applyFilters s·ª≠a ƒë·ªÉ l·∫•y Customer t·ª´ blockIndex 0 -->

<script>
function applyFilters(reset = true) {
  if (reset) {
    currentOffset = 0;
    $('#results-table tbody').empty();
  }
  let queryParams = { limit: pageSize, offset: currentOffset };
  // Collect filter values
  for (let i = 1; i <= 4; i++) {
    const col = (i === 1) ? 'Customer' : $(`#filter-column-${i}`).val();
    const values = $(`#filter-value-${i}`).val();
    if (values && values.length > 0) {
      queryParams[col] = values.join(',');
    }
  }
  currentFilters = queryParams;
  const queryString = $.param(queryParams);
  $.getJSON(`/search?${queryString}`, function(response) {
    totalData = response.total;
    currentOffset += pageSize;
    updateTable(response.data, true);
  });
}
</script>


</script>

</body>
</html>
